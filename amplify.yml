version: 1
frontend:
  environment:
    variables:
      PATH: "/usr/local/go/bin:/usr/local/bin:$PATH"
  phases:
    preBuild:
      commands:
        # ─── Skip curl install ────────────────────────────────────────────────
        # sudo dnf install -y curl

        # Install Hugo from the AL2023 repos
        - sudo dnf install -y hugo
        - echo "✔️ Hugo installed via dnf"

        # Install Go 1.23.3
        - curl -LO "https://dl.google.com/go/go1.23.3.linux-amd64.tar.gz"
        - sudo tar -C /usr/local -xzf go1.23.3.linux-amd64.tar.gz
        - rm go1.23.3.linux-amd64.tar.gz
        - echo "✔️ Go 1.23.3 installed"

        # Install JS dependencies
        - npm ci

    build:
      commands:
        - npm run project-setup
        - npm run build

  artifacts:
    baseDirectory: public
    files:
      - '**/*'

  cache:
    paths:
      - node_modules/**/*